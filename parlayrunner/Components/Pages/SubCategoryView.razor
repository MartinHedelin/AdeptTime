@page "/subcategory/{ParentCategory}/{CategoryName}"
@using parlayrunner.Shared.Interfaces;
@inject NavigationManager NavigationManager
@inject ICloudService CloudService
@inject IParlayService ParlayService

<div class="home-container">
    <div class="sports-scroll">
        @foreach (var category in ViewModel.Categories)
        {
            <span>@category.Name</span>
        }
    </div>

    <div class="content-area">
        <div class="matches-container">
            <h3 class="day-section-title">Today</h3>

            @{
                var groupedMatches = ViewModel?.Matches?
                    .GroupBy(m => m.Time)
                    .OrderBy(g => g.Key);
            }

            @if (groupedMatches != null)
            {
                @foreach (var timeGroup in groupedMatches)
                {
                    <h3 class="section-title">@timeGroup.Key</h3>
                    @foreach (var match in timeGroup)
                    {
                        <div class="match-card">
                            <div class="match-teams">
                                <div class="team">@match.HomeTeam</div>
                                <div class="team">@match.AwayTeam</div>
                            </div>
                            <div class="match-odds">
                                <button class="odd-button @(ViewModel._parlayService.IsBetSelected(match.Id, "1") ? "selected" : "")"
                                        @onclick='() => ViewModel._parlayService.AddBet(match, "1", match.HomeOdd)'>
                                    <div class="odd-type">1</div>
                                    <div class="odd-value">@match.HomeOdd</div>
                                </button>
                                <button class="odd-button @(ViewModel._parlayService.IsBetSelected(match.Id, "X") ? "selected" : "")"
                                        @onclick='() => ViewModel._parlayService.AddBet(match, "X", match.DrawOdd)'>
                                    <div class="odd-type">X</div>
                                    <div class="odd-value">@match.DrawOdd</div>
                                </button>
                                <button class="odd-button @(ViewModel._parlayService.IsBetSelected(match.Id, "2") ? "selected" : "")"
                                        @onclick='() => ViewModel._parlayService.AddBet(match, "2", match.AwayOdd)'>
                                    <div class="odd-type">2</div>
                                    <div class="odd-value">@match.AwayOdd</div>
                                </button>
                                <div class="more-odds">+@match.MoreOdds</div>
                            </div>
                        </div>
                    }
                }
            }
        </div>
    </div>
</div>

@code {
    [Parameter]
    public string CategoryName { get; set; }

    [Parameter]
    public string ParentCategory { get; set; }

    private SubCategoryViewModel ViewModel;

    protected override void OnInitialized()
    {
        ViewModel = new SubCategoryViewModel(CloudService, ParlayService, CategoryName, ParentCategory);
    }

    protected override void OnParametersSet()
    {
        ViewModel = new SubCategoryViewModel(CloudService, ParlayService, CategoryName, ParentCategory);
    }
}